<% content_for :page_title do %>
<%= Spree.t(:current_orders) %>
<% end %>

<% if @orders.any? %>

<table class="index responsive" id="listing_orders" data-hook>

	<thread>
		<tr role="row" data-hook="admin_orders_index_headers">
			<th role="columnheader" class="center" rowspan="1" colspan="1">
			</th>

			<th><%= sort_link @search, :number, I18n.t(:number, :scope => 'activerecord.attributes.spree/order') %></th>

			<th><%= sort_link @search, :created_at, I18n.t(:created_at, :scope => 'activerecord.attributes.spree/order') %></th>

			<th><%= sort_link @search, :payment_state, I18n.t(:payment_state, :scope => 'activerecord.attributes.spree/order') %></th>
			<% if Spree::Order.checkout_step_names.include?(:delivery) %>

			<th><%= sort_link @search, :shipment_state, I18n.t(:shipment_state, :scope => 'activerecord.attributes.spree/order') %></th>
			<% end %>
			<th><%= sort_link @search, :email, I18n.t(:email, :scope => 'activerecord.attributes.spree/order') %></th>
			<th><%= sort_link @search, :total, I18n.t(:total, :scope => 'activerecord.attributes.spree/order') %></th>
			<th data-hook="admin_orders_index_header_actions" class="actions"></th>
		</tr>
	</thread>
	<tbody>
		<% @orders.each do |order| %>
		<tr data-hook="admin_orders_index_rows" class="state-<%= order.state.downcase %> <%= cycle('odd', 'even') %> table-row">
			<td><span class="plus-minus"> + </span></td>
			<td class="align-center"><%= link_to order.number, edit_admin_order_path(order) %></td>
			<td class="align-center"><%= l (@show_only_completed ? order.completed_at : order.created_at).to_date %></td>

			<td class="align-center"><span class="state <%= order.payment_state %>"><%= link_to Spree.t("payment_states.#{order.payment_state}"), admin_order_payments_path(order) if order.payment_state %></span></td>
			<% if Spree::Order.checkout_step_names.include?(:delivery) %>
			<td class="align-center"><span class="state <%= order.shipment_state %>"><%= Spree.t("shipment_states.#{order.shipment_state}") if order.shipment_state %></span></td>
			<% end %>
			<td class="align-center"><%= mail_to order.email %></td>
			<td class="align-center"><%= order.display_total.to_html %></td>
			<td class='actions align-center' data-hook="admin_orders_index_row_actions">
				<%= link_to_edit_url edit_admin_order_path(order), :title => "admin_edit_#{dom_id(order)}", :no_text => true %>
			</td>

		</tr>

			<thread>
				<tr style="display:none">
					<th></th>
					<th>Name</th>
					<th>Size/Variants</th>
					<th>Quantity</th>
				</tr>
			</thread>

			<% order.line_items.each do |item| %>
			<tr class="line-item" id="line-item-<%= item.id %>" style="display:none">
				<td></td>
				<td class="line-item-name">
					<%= item.variant.product.name %>
				</td>

				<td class="line-item-variant">
					<% if item.variant.option_values.empty? %>
						Standard
					<% else %>
						<%= variant_options(item.variant) %>
					<% end %>
				</td>

				<td class="line-item-qty-show align-center">
					<%= item.quantity %>
				</td>
			</tr>
			<% end %>

		

		<% end %>

		<script> $('.table-row').click(function(){
			$(this).find('span.plus-minus').text(function(_, value){return value=='-'?'+':'-'});
			$(this).nextUntil('tr.table-row').slideToggle(50, function(){
			});
		});</script>


	</tbody>
</table>
<% else %>
<div class="alpha twelve columns no-objects-found">
	<%= Spree.t(:no_resource_found, resource: I18n.t(:other, scope: 'activerecord.models.spree/order')) %>,
	<%= link_to Spree.t(:add_one), spree.new_admin_order_path %>!
</div>
<% end %>

<%= paginate @orders %>